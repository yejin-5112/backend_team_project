<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nome cart</title>
    <link rel="stylesheet" href="common/header.css" />
    <style>
      .section_1 {
        width: 100%;
        height: 100vh;
        padding: 80px 100px;
      }
      .title {
        text-align: center;
        font-size: 35px;
        margin-bottom: 30px;
      }
      .con_wrap {
        width: 100%;
        height: 500px;
        overflow-y: auto;
        padding: 0 20px;
        margin-bottom: 10px;
        border-top: 1px solid #0b1838;
        border-bottom: 1px solid #0b1838;
      }
      .con_wrap > :last-child {
        display: none;
      }
      .item_wrap {
        width: 100%;
        height: 120px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 50px;
      }
      .item_img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border: 1px solid rgba(0, 0, 0, 0.5);
      }
      .item_text {
        width: 100px;
        font-size: 16px;
      }
      .count_wrap {
        width: 80px;
        height: 24px;
        border: 1px solid #0b1838;
        display: flex;
        justify-content: space-between;
        align-items: center;
        user-select: none;
        margin-left: 600px;
      }
      .minus,
      .plus {
        width: 23px;
        height: 23px;
        font-size: 12px;
        text-align: center;
        line-height: 23px;
        font-weight: 300;
        cursor: pointer;
        overflow: hidden;
        z-index: 10;
      }
      .item_count {
        width: 34px;
        height: 24px;
        text-align: center;
        font-size: 14px;
        border: 1px solid #0b1838;
        line-height: 24px;
      }
      .item_price {
        width: 90px;
        text-align: right;
        font-size: 14px;
        margin-left: -50px;
      }
      .total {
        width: 100%;
        font-size: 18px;
        text-align: right;
        padding-right: 50px;
      }
      .buy_btn {
        width: 200px;
        height: 50px;
        background-color: #dce5ed;
        border: 1px solid #0b1838;
        margin: 10px auto;
        text-align: center;
        line-height: 50px;
        font-size: 18px;
        cursor: pointer;
        user-select: none;
      }

      .del_btn {
        width: 20px;
        height: 20px;
        object-fit: cover;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <header>
      <img
        onclick="location.href='index.html'"
        src="images/logo_b.png"
        alt="로고"
        class="logo"
      />
      <div class="menu_wrap">
        <div class="menu" onclick="location.href='addItem.html'">ADD MENU</div>
        <div class="menu" onclick="location.href='login.html'">LOGIN</div>
        <div class="menu" onclick="location.href='qna.html'">Q&A</div>
        <div class="menu" onclick="location.href='profile.html'">MY PAGE</div>
        <div class="menu" onclick="location.href='cart.html'">CART</div>
      </div>
    </header>

    <section class="section_1">
      <div class="title">CART</div>
      <div class="con_wrap">
        <div class="item_wrap">
          <img class="item_img" src="images/bg1.png" alt="푸딩딩" />
          <div class="item_text">푸딩</div>
          <div class="count_wrap">
            <div class="minus">▼</div>
            <div class="item_count">1</div>
            <div class="plus">▲</div>
          </div>
          <div class="item_price" data-unit-price="상품단가">3000원</div>
          <img class="del_btn" src="images/del.png" alt="삭제" />
        </div>
        <div class="dash"></div>

        <div class="item_wrap">
          <img class="item_img" src="images/bg2.png" alt="푸딩딩" />
          <div class="item_text">푸딩</div>
          <div class="count_wrap">
            <div class="minus">▼</div>
            <div class="item_count">1</div>
            <div class="plus">▲</div>
          </div>
          <div class="item_price" data-unit-price="상품단가">3000원</div>
          <img class="del_btn" src="images/del.png" alt="삭제" />
        </div>
        <div class="dash"></div>

        <div class="item_wrap">
          <img class="item_img" src="images/bg3.png" alt="푸딩딩" />
          <div class="item_text">푸딩</div>
          <div class="count_wrap">
            <div class="minus">▼</div>
            <div class="item_count">1</div>
            <div class="plus">▲</div>
          </div>
          <div class="item_price" data-unit-price="상품단가">3000원</div>
          <img class="del_btn" src="images/del.png" alt="삭제" />
        </div>
        <div class="dash"></div>

        <div class="item_wrap">
          <img class="item_img" src="images/bg1.png" alt="푸딩딩" />
          <div class="item_text">푸딩</div>
          <div class="count_wrap">
            <div class="minus">▼</div>
            <div class="item_count">2</div>
            <div class="plus">▲</div>
          </div>
          <div class="item_price" data-unit-price="상품단가">3000원</div>
          <img class="del_btn" src="images/del.png" alt="삭제" />
        </div>
        <div class="dash"></div>

        <div class="item_wrap">
          <img class="item_img" src="images/bg3.png" alt="푸딩딩" />
          <div class="item_text">푸딩</div>
          <div class="count_wrap">
            <div class="minus">▼</div>
            <div class="item_count">1</div>
            <div class="plus">▲</div>
          </div>
          <div class="item_price" data-unit-price="상품단가">3000원</div>
          <img class="del_btn" src="images/del.png" alt="삭제" />
        </div>
        <div class="dash"></div>

        <div class="item_wrap">
          <img class="item_img" src="images/bg3.png" alt="푸딩딩" />
          <div class="item_text">푸딩</div>
          <div class="count_wrap">
            <div class="minus">▼</div>
            <div class="item_count">1</div>
            <div class="plus">▲</div>
          </div>
          <div class="item_price" data-unit-price="상품단가">3000원</div>
          <img class="del_btn" src="images/del.png" alt="삭제" />
        </div>
        <div class="dash"></div>
      </div>
      <div class="total">총 금액 : 3000원</div>
      <div class="buy_btn">구매하기</div>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const container = document.querySelector(".con_wrap");
        const totalDiv = document.querySelector(".total");
        const buyBtn = document.querySelector(".buy_btn");
        let cartItems = JSON.parse(localStorage.getItem("cart") || "[]");

        /* container.innerHTML = ""; */
        let total = 0;

        cartItems.forEach((item, idx) => {
          const itemWrap = document.createElement("div");
          itemWrap.className = "item_wrap";

          const img = document.createElement("img");
          img.className = "item_img";
          img.src = item.imageUrl;
          img.alt = item.name;

          const name = document.createElement("div");
          name.className = "item_text";
          name.textContent = item.name;

          const countWrap = document.createElement("div");
          countWrap.className = "count_wrap";

          const minus = document.createElement("div");
          minus.className = "minus";
          minus.textContent = "-";

          const countEl = document.createElement("div");
          countEl.className = "item_count";
          countEl.textContent = item.count;

          const plus = document.createElement("div");
          plus.className = "plus";
          plus.textContent = "+";

          countWrap.appendChild(minus);
          countWrap.appendChild(countEl);
          countWrap.appendChild(plus);

          const priceDiv = document.createElement("div");
          priceDiv.className = "item_price";
          priceDiv.dataset.unitPrice = item.price;
          priceDiv.textContent =
            (item.price * item.count).toLocaleString() + "원";

          const delBtn = document.createElement("img");
          delBtn.className = "del_btn";
          delBtn.src = "images/del.png";
          delBtn.alt = "삭제";

          const bar = document.createElement("div");
          bar.className = "dash";

          itemWrap.appendChild(img);
          itemWrap.appendChild(name);
          itemWrap.appendChild(countWrap);
          itemWrap.appendChild(priceDiv);
          itemWrap.appendChild(delBtn);

          container.appendChild(itemWrap);
          container.appendChild(dash);

          total += item.price * item.count;

          plus.addEventListener("click", () => {
            item.count++;
            countEl.textContent = item.count;
            priceDiv.textContent =
              (item.price * item.count).toLocaleString() + "원";
            updateCart();
          });

          minus.addEventListener("click", () => {
            if (item.count > 1) {
              item.count--;
              countEl.textContent = item.count;
              priceDiv.textContent =
                (item.price * item.count).toLocaleString() + "원";
              updateCart();
            }
          });

          delBtn.addEventListener("click", () => {
            cartItems.splice(idx, 1); // 배열에서 삭제
            localStorage.setItem("cart", JSON.stringify(cartItems)); // 저장
            itemWrap.remove(); // DOM에서 제거
            bar.remove();
            updateCart(); // 총 금액 갱신
          });
        });

        totalDiv.textContent = "총 금액 : " + total.toLocaleString() + "원";

        function updateCart() {
          localStorage.setItem("cart", JSON.stringify(cartItems));
          const newTotal = cartItems.reduce(
            (sum, item) => sum + item.price * item.count,
            0
          );
          totalDiv.textContent =
            "총 금액 : " + newTotal.toLocaleString() + "원";
        }

        buyBtn.addEventListener("click", () => {
          if (cartItems.length === 0) {
            alert("장바구니에 상품이 없습니다.");
            return;
          }

          const orders = JSON.parse(localStorage.getItem("orders") || "[]");
          const now = new Date();
          const date =
            now.getFullYear() +
            "-" +
            String(now.getMonth() + 1).padStart(2, "0") +
            "-" +
            String(now.getDate()).padStart(2, "0") +
            " " +
            String(now.getHours()).padStart(2, "0") +
            ":" +
            String(now.getMinutes()).padStart(2, "0");

          cartItems.forEach((item) => {
            orders.push({
              name: item.name,
              price: item.price,
              count: item.count,
              imageUrl: item.imageUrl,
              date: date,
            });
          });

          localStorage.setItem("orders", JSON.stringify(orders));
          localStorage.removeItem("cart");
          alert("구매되었습니다.");
          location.href = "index.html";
        });
      });
    </script>
  </body>
</html>
